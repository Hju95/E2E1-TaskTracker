<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Task Tracker</title>

    <!-- Custom fonts for this template-->
    <link href="/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="/css/sb-admin-2.min.css" rel="stylesheet">
    <style>
        .btn-switch .icon-switch {
            position: absolute;
            top: 50%;
            transform: translate(0, -50%);
        }
    </style>

    <!-- Bootstrap core JavaScript-->
    <script src="/vendor/jquery/jquery.min.js"></script>
    <script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="/vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="/js/sb-admin-2.min.js"></script>

</head>

<body id="page-top">

<!-- Page Wrapper -->
<div id="wrapper">

    <!-- 왼쪽메뉴 Sidebar -->
    <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">
        <div th:replace="admin_left :: includedContent"></div>
    </ul>
    <!-- End of Sidebar -->

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

        <!-- Main Content -->
        <div id="content">

            <div th:replace="admin_top :: includedContent"></div>
            <!-- Begin Page Content -->
            <div class="container-fluid">
                <th:block th:each="user : ${userList}">
                    <div>

                        <p>Email: <span th:text="${user.email}"></span></p>
                        <p>Name: <span th:text="${user.name}"></span></p>
                        <!-- 다른 필드들도 유사한 방식으로 표시할 수 있습니다 -->
                        <hr> <!-- 각 사용자 정보를 구분하기 위한 수평선 -->
                    </div>
                </th:block>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">회원정보 목록</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered table-hover">
                                <thead>
                                <tr>
                                    <th>아이디</th>
                                    <th>이메일</th>
                                    <th>이름</th>
                                    <th>관리자 여부</th>
                                    <th>이용 제제</th>
                                    <th>생성일시</th>
                                    <th>생성자</th>
                                    <th>수정일시</th>
                                    <th>수정자</th>
                                </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="member : ${resultList}">
                                        <td th:text="${member.id}"></td>
                                        <td th:text="${member.email}"></td>
                                        <td th:text="${member.name}"></td>
                                        <td th:text="${member.adminCheck ? 'Yes' : 'No'}"></td>
                                        <td><button th:onclick="'javascript:fn_toggleBan('+ ${member.id} + ', '+ ${member.isBan()} +','+ this +') '" th:class="${member.adminCheck == true} ? 'btn btn-success' : 'btn btn-danger'" th:text="${member.adminCheck == true} ? 'ON' : 'OFF'"></button></td>
                                        <td th:text="${member.createdAt}"></td>
                                        <td th:text="${member.createdBy}"></td>
                                        <td th:text="${member.modifiedAt}"></td>
                                        <td th:text="${member.modifiedBy}"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>



            </div>
            <!-- /.container-fluid -->

        </div>
        <!-- End of Main Content -->

        <!-- Footer -->
        <footer class="sticky-footer bg-white">
            <div class="container my-auto">
                <div class="copyright text-center my-auto">
                    <span>Copyright &copy; Your Website 2021</span>
                </div>
            </div>
        </footer>
        <!-- End of Footer -->

    </div>
    <!-- End of Content Wrapper -->

</div>
<!-- End of Page Wrapper -->

<!-- Scroll to Top Button-->
<a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
</a>

<!-- Logout Modal-->
<div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
                <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
            <div class="modal-footer">
                <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                <a class="btn btn-primary" href="/login">Logout</a>
            </div>
        </div>
    </div>
</div>

    <script>
        $(document).ready(function () {
            var dashboardURL = 'http://13.124.80.75/public/dashboards/gTIHztSsz8UDJMFffjoxKdGgogf6wRf06L64soml?org_slug=default';
            var iframe = $('<iframe>', {
                src: dashboardURL,
                frameborder: 0,
                scrolling: 'no',
                width: '100%',
                height: '1080'
            });
            $('#redash').append(iframe);
        });

        function fn_toggleBan(paramId,paramBan, element){
            let id = paramId;
            let isBan = !paramBan; //현재 값의 반대로 가져옴.

            if (!confirm("수정 하시겠습니까?")) { return; }

            let data = {
                id: id,
                isBan: isBan
            };
            let updatedAttr = isBan ? 'btn-success' : 'btn-danger';
            element.className = updatedAttr;
            element.innerText = isBan ? 'ON' : 'OFF';
            element.onclick = function() { fn_toggleBan(id, isBan, this); };
            fetch('/admin/api/updateIsBan', {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json', }, // 요청의 Content-Type 설정
                body: JSON.stringify(data) // 요청에 포함될 데이터
            })
                .then(response => {
                    console.log('PUT 요청 성공:', response);
                    let updatedAttr = isBan ? 'btn-success' : 'btn-danger';
                    element.className = updatedAttr;
                    element.value = isBan;
                })
                .catch(error => {
                    console.error('PUT 요청 실패:', status, error);
                });
        }
    </script>
</body>
</html>